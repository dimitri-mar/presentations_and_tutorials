---
title: "From R to Py"
author: "Dimitri Marinelli"
date: "25/5/2021 - #DataForGood - CorrelAid Rhein-Main"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

To use python in R you can use the library "reticulate" 

## Starting up


```{r}
# install.packages("reticulate")
library(reticulate)

# [convert = TRUE] => convert Python objects to R when appropriate
sys <- import("sys", convert = TRUE)

# dollar operator replaces the dot in python:
sys$path

os <- import("os", convert=TRUE)

# the equivalent of sys.executable
sys$executable
```
The executable shows what environment reticulate is using. Checking this variable
is useful because reticulate tends to automatize many things, and one ends up 
not knowing which Python environment reticulate is actually using. 

It is possible to be (almost) Python agnostic, avoid any command line:

If you use conda you can check what enviroments are available from R, and then
"activate" the enviroment that reticulate will use

```{r}
print(conda_list(conda = "auto"))
use_condaenv(condaenv = "ds", conda = "auto", required = FALSE)
```
that are the equivalent of 
```
conda env list
conda activate ds
``` 

## Use pure Python

It is possible to include in Rmd files chunks of python code, and it also 
supports the rendering of plots. (You need to write `plt.show() otherwise does 
not work).

```{python}
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# Load the example diamonds dataset
diamonds = sns.load_dataset("diamonds")

# Draw a scatter plot while assigning point colors and sizes to different
# variables in the dataset
f, ax = plt.subplots(figsize=(6.5, 6.5))
sns.despine(f, left=True, bottom=True)
clarity_ranking = ["I1", "SI2", "SI1", "VS2", "VS1", "VVS2", "VVS1", "IF"]
s = sns.scatterplot(x="carat", y="price",
                hue="clarity", size="depth",
                palette="ch:r=-.2,d=.3_r",
                hue_order=clarity_ranking,
                sizes=(1, 8), linewidth=0,
                data=diamonds, ax=ax)
                
plt.show()
```

However, even if the chunk is in Python, one can retrieve the variables in R. 

```{r}
py$diamonds |> head()


```

